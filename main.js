(()=>{"use strict";var e=document.querySelector(".popup_type_edit"),t=document.querySelector(".popup_type_new-card"),n=document.querySelector(".popup_type_edit_avatar"),o=document.querySelector(".profile__edit-button"),r=document.querySelector(".profile__title"),c=document.querySelector(".profile__description"),a=document.querySelector(".profile__image"),i=e.querySelector(".popup__form"),u=e.querySelector(".popup__input_type_name"),s=e.querySelector(".popup__input_type_description"),l=document.querySelector(".profile__add-button"),p=t.querySelector(".popup__form"),d=t.querySelector(".popup__input_type_card-name"),_=t.querySelector(".popup__input_type_url"),f=document.querySelector(".popup_type_image"),m=f.querySelector(".popup__image"),h=f.querySelector(".popup__caption"),v=document.querySelector(".profile__image-container"),y=n.querySelector(".popup__form"),S=n.querySelector(".popup__input_type_url"),q=document.querySelector("#card-template").content,b=document.querySelector(".places__list");function E(e){C(e.target.closest(".popup"))}function L(e){e.target.classList.contains("popup_is-opened")&&C(e.target.closest(".popup_is-opened"))}function g(e){"Escape"===e.key&&C(document.querySelector(".popup_is-opened"))}function k(e){document.addEventListener("click",L),document.addEventListener("keyup",g),e.querySelector(".popup__close").addEventListener("click",E),e.classList.add("popup_is-opened")}function C(e){e.classList.contains("popup_is-opened")&&(document.removeEventListener("click",L),document.removeEventListener("keyup",g),e.querySelector(".popup__close").removeEventListener("click",E),e.classList.remove("popup_is-opened"))}var x,z=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)},A={baseUrl:"https://nomoreparties.co/v1/".concat("apf-cohort-202"),headers:{authorization:"50288585-95b2-4a44-8fa9-1f099e765284","Content-Type":"application/json"}};function U(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function T(e,t){(function(e){return fetch("".concat(A.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:{authorization:A.headers.authorization}}).then(U)})(t).then(e.target.closest(".places__item").remove()).catch((function(e){return console.log(e)}))}function P(e,t,n,o,r,c){var a=q.querySelector(".card").cloneNode(!0),i=a.querySelector(".card__image"),u=a.querySelector(".card__title"),s=a.querySelector(".card__like-button"),l=a.querySelector(".card__like-count"),p=a.querySelector(".card__delete-button");return i.src=t,i.alt="Photo: "+e,u.textContent=e,l.textContent=n.length,r&&c?(n.some((function(e){c===e._id&&s.classList.toggle("card__like-button_is-active")})),r===c?p.addEventListener("click",(function(e){T(e,o)})):p.remove()):p.addEventListener("click",(function(e){T(e,o)})),s.addEventListener("click",(function(e){!function(e,t,n){(function(e,t){return t?fetch("".concat(A.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:A.headers.authorization}}).then(U):fetch("".concat(A.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:A.headers.authorization}}).then(U)})(t,e.target.classList.contains("card__like-button_is-active")).then((function(t){n.textContent=t.likes.length,e.target.classList.toggle("card__like-button_is-active")})).catch((function(e){return console.log(e)}))}(e,o,l)})),i.addEventListener("click",(function(){m.src=t,m.alt=e,h.textContent=e,k(f)})),a}function B(e){e.target.querySelector(".popup__button").textContent="Сохранение..."}function D(e){e.target.querySelector(".popup__button").textContent="Сохранить"}Promise.all([fetch("".concat(A.baseUrl,"/users/me"),{method:"GET",headers:{authorization:A.headers.authorization}}).then(U),fetch("".concat(A.baseUrl,"/cards"),{method:"GET",headers:{authorization:A.headers.authorization}}).then(U)]).then((function(e){var t=e[0]._id;r.textContent=e[0].name,c.textContent=e[0].about,a.src=e[0].avatar,a.alt="Avatar: ".concat(e[0].name),e[1].forEach((function(e){b.append(P(e.name,e.link,e.likes,e._id,e.owner._id,t))}))})).catch((function(e){return console.log(e)})),o.addEventListener("click",(function(){return t=e,u.setAttribute("value",r.textContent),s.setAttribute("value",c.textContent),void k(t);var t})),i.addEventListener("submit",(function(t){t.preventDefault();var n=u.value,o=s.value;B(t),n===r&&o===c||function(e,t){return fetch("".concat(A.baseUrl,"/users/me"),{method:"PATCH",headers:A.headers,body:JSON.stringify({name:e,about:t})}).then(U)}(n,o).then((function(t){r.textContent=t.name,c.textContent=t.about,C(e)})).catch((function(e){return console.log(e)})).finally((function(){return D(t)}))})),l.addEventListener("click",(function(){return k(t)})),p.addEventListener("submit",(function(e){e.preventDefault();var n=d.value,o=_.value;B(e),function(e,t){return fetch("".concat(A.baseUrl,"/cards"),{method:"POST",headers:A.headers,body:JSON.stringify({name:e,link:t})}).then(U)}(n,o).then((function(e){b.prepend(P(e.name,e.link,e.likes,e._id)),C(t)})).catch((function(e){return console.log(e)})).finally((function(){return D(e)}))})),v.addEventListener("click",(function(){return k(n)})),y.addEventListener("submit",(function(e){e.preventDefault();var t,o=S.value;B(e),(t=o,fetch("".concat(A.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:A.headers,body:JSON.stringify({avatar:t})}).then(U)).then((function(e){a.src=e.avatar,a.alt="Avatar: ".concat(e.name),C(n)})).catch((function(e){return console.log(e)})).finally((function(){return D(e)}))})),x={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_error_active",errorClass:"popup__input-error"},Array.from(document.querySelectorAll(x.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);z(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),z(n,o,t)}))}))}(e,x)}))})();